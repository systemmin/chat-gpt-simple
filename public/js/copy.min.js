const locales = {
	en: ["Copy", "Copied!", "Copied to clipboard"],
	es: ["Copiar", "¡Copiado!", "Copiado al portapapeles"],
	fr: ["Copier", "Copié !", "Copié dans le presse-papier"],
	de: ["Kopieren", "Kopiert!", "In die Zwischenablage kopiert"],
	ja: ["コピー", "コピーしました！", "クリップボードにコピーしました"],
	ko: ["복사", "복사됨!", "클립보드에 복사됨"],
	ru: ["Копировать", "Скопировано!", "Скопировано в буфер обмена"],
	zh: ["复制", "已复制!", "已复制到剪贴板"],
	"zh-tw": ["複製", "已複製!", "已複製到剪貼簿"]
};

function opyToClipboard(text) {
	var input = document.createElement("textarea");
	input.value = text;
	document.body.appendChild(input);
	input.select();
	document.execCommand("copy");
	document.body.removeChild(input);
}
class CopyButtonPlugin {
	constructor(options = {}) {
		self.hook = options.hook;
		self.callback = options.callback;
		self.lang = options.lang || document.documentElement.lang || "en"
	}

	'before:highlightElement'({
		el,
		language,
	}) {
		console.log(language)
		el.parentElement.style.position = 'relative';
		el.style.paddingTop = '20px';
		let div = Object.assign(document.createElement("div"), {
			className: "hljs-custom-copy"
		});
		const left = document.createElement("div")
		const span = document.createElement("span")
		span.innerText = language;
		left.style.textIndent="10px"
		left.append(span)
		div.append(left)
		const right = document.createElement("div")
		right.className='hljs-custom-copy-icon';
		div.appendChild(right)
		el.parentElement.appendChild(div);
		right.onclick = function() {
			opyToClipboard(el.innerText);
			right.innerHTML='已复制到剪贴板';
		}
		// el.dataset.language = result.language;
	}
	// "after:highlightElement"({
	// 	el,
	// 	text
	// }) {
	// 	let button = Object.assign(document.createElement("button"), {
	// 		innerHTML: locales[lang]?.[0] || "Copy",
	// 		className: "hljs-copy-button"
	// 	});
	// 	button.dataset.copied = false;
	// 	el.parentElement.classList.add("hljs-copy-wrapper");
	// 	el.parentElement.appendChild(button);
	// 	el.parentElement.style.setProperty("--hljs-theme-background", window.getComputedStyle(el).backgroundColor);
	// 	button.onclick = function() {
	// 		console.log('button.onclick')
	// 		let newText = text;
	// 		if (hook && typeof hook === "function") {
	// 			newText = hook(text, el) || text
	// 		}
	// 		opyToClipboard(newText);
	// 		console.log('ffffffffffffff')
	// 		button.innerHTML = locales[lang]?.[1] || "Copied!";
	// 		button.dataset.copied = true;
	// 		let alert = Object.assign(document.createElement("div"), {
	// 			role: "status",
	// 			className: "hljs-copy-alert",
	// 			innerHTML: locales[lang]?.[2] || "Copied to clipboard"
	// 		});
	// 		el.parentElement.appendChild(alert);
	// 		setTimeout(() => {
	// 			button.innerHTML = locales[lang]?.[0] || "Copy";
	// 			button.dataset.copied = false;
	// 			el.parentElement.removeChild(alert);
	// 			alert = null
	// 		}, 2e3)
	// 	}
	// }

}